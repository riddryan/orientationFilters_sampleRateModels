function J = JMag(acc,mag,q)
q1 = q(1);q2 = q(2);q3 = q(3);q4 =q(4);
ax = acc(1); ay=acc(2); az= acc(3);
mx = mag(1); my = mag(2); mz = mag(3);
% J = [  2*my*q2 + 2*mz*q1, - 2*mx*q2 - 2*mz*q4, 2*my*q4 - 2*mx*q1, - 2*ay*q2 - 2*az*q1, 2*ax*q2 + 2*az*q4,   2*ax*q1 - 2*ay*q4
%   2*my*q1 - 2*mz*q2, - 2*mx*q1 - 2*mz*q3, 2*mx*q2 + 2*my*q3,   2*az*q2 - 2*ay*q1, 2*ax*q1 + 2*az*q3, - 2*ax*q2 - 2*ay*q3
%   2*mz*q3 - 2*my*q4,   2*mx*q4 - 2*mz*q2, 2*my*q2 - 2*mx*q3,   2*ay*q4 - 2*az*q3, 2*az*q2 - 2*ax*q4,   2*ax*q3 - 2*ay*q2
% - 2*my*q3 - 2*mz*q4,   2*mx*q3 - 2*mz*q1, 2*mx*q4 + 2*my*q1,   2*ay*q3 + 2*az*q4, 2*az*q1 - 2*ax*q3, - 2*ax*q4 - 2*ay*q1];
% 


J = -[q1*((2*mz)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (2*my*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q2*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q4*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (q2*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*mz*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*mx*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q1*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q4*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*my*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q1*((2*mx)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (q2*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q4*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (q2*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*ay*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q1*((2*az)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (q4*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*ax*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (2*az*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q2*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q1*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q4*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q1*((2*ax)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (2*ay*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q2*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q4*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)
(2*my*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q2*((2*mz)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (q1*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q3*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (q1*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*mz*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*mx*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q2*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q3*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q2*((2*mx)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (2*my*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q1*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q3*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q2*((2*az)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (2*ay*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q1*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q3*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*ax*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (2*az*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q1*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q2*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q3*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (q3*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*ay*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q1*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - q2*((2*ax)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2))
q3*((2*mz)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (2*my*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q4*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q2*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*mx*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*mz*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q4*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q3*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q2*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*my*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q3*((2*mx)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (q4*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q2*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*ay*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q3*((2*az)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (q4*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q2*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*az*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*ax*q4)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q4*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q3*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q2*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q3*((2*ax)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) - (2*ay*q2)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q4*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q2*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)
(q3*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*my*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q4*((2*mz)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (q1*(2*my*(ax*my - ay*mx) + 2*mz*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*mx*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*mz*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q3*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q4*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q1*(2*mx*(ax*my - ay*mx) - 2*mz*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q4*((2*mx)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (2*my*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q3*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q1*(2*mx*(ax*mz - az*mx) + 2*my*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), q4*((2*az)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (2*ay*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (q3*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (q1*(2*ay*(ax*my - ay*mx) + 2*az*(ax*mz - az*mx))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (2*az*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - (2*ax*q3)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) + (q3*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q4*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) + (q1*(2*ax*(ax*my - ay*mx) - 2*az*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2), (q3*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*my - ay*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2) - (2*ay*q1)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - q4*((2*ax)/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(1/2) - ((2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ax*mz - az*mx))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)) + (q1*(2*ax*(ax*mz - az*mx) + 2*ay*(ay*mz - az*my))*(ay*mz - az*my))/((ax*my - ay*mx)^2 + (ax*mz - az*mx)^2 + (ay*mz - az*my)^2)^(3/2)];